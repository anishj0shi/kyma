apiVersion: kubeless.io/v1beta1
kind: Function
metadata:
  annotations:
    function-size: S
  name: callback-function
spec:
  handler: handler.main
  runtime: nodejs8
  type: HTTP
  deployment:
    spec:
      template:
        spec:
          containers:
          - name: size-s
            resources:
              limits:
                cpu: 100m
                memory: 128Mi
              requests:
                cpu: 100m
                memory: 100Mi
  function: |
    module.exports = {
        main: function (event, context) {
            return event.data + ": Call to the function load-test was successful!";
        }
    }
  horizontalPodAutoscaler:
    metadata:
      namespace: $NAMESPACE
      labels:
        function: callback-function
        app: perf-test-event-bus
      name: callback-function
    spec:
      maxReplicas: 2
      metrics:
      - resource:
          name: cpu
          targetAverageUtilization: 50
        type: Resource
      minReplicas: 1
      scaleTargetRef:
        apiVersion: apps/v1beta1
        kind: Deployment
        name: callback-function

